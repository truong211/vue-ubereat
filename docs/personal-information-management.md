# H·ªá th·ªëng Qu·∫£n l√Ω Th√¥ng tin C√° nh√¢n (Personal Information Management System)

## T·ªïng quan

T√¥i ƒë√£ tri·ªÉn khai m·ªôt h·ªá th·ªëng qu·∫£n l√Ω th√¥ng tin c√° nh√¢n ho√†n ch·ªânh cho ·ª©ng d·ª•ng food delivery v·ªõi c√°c t√≠nh nƒÉng sau:

### üéØ C√°c t√≠nh nƒÉng ch√≠nh

1. **Xem th√¥ng tin c√° nh√¢n** - View personal information
2. **Ch·ªânh s·ª≠a h·ªì s∆°** - Edit profile (t√™n, email, s·ªë ƒëi·ªán tho·∫°i, ·∫£nh ƒë·∫°i di·ªán)
3. **Qu·∫£n l√Ω danh s√°ch ƒë·ªãa ch·ªâ giao h√†ng** - Manage delivery addresses
4. **Xem l·ªãch s·ª≠ ƒë∆°n h√†ng** - View order history

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

### Backend API

#### 1. Routes (`backend/routes/user.routes.js`)
```javascript
// User Profile Routes
GET    /api/user/profile              - L·∫•y th√¥ng tin c√° nh√¢n
PUT    /api/user/profile              - C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n
POST   /api/user/profile/avatar       - T·∫£i l√™n ·∫£nh ƒë·∫°i di·ªán
DELETE /api/user/profile/avatar       - X√≥a ·∫£nh ƒë·∫°i di·ªán

// Address Management Routes
GET    /api/user/addresses            - L·∫•y danh s√°ch ƒë·ªãa ch·ªâ
POST   /api/user/addresses            - T·∫°o ƒë·ªãa ch·ªâ m·ªõi
GET    /api/user/addresses/:id        - L·∫•y chi ti·∫øt ƒë·ªãa ch·ªâ
PUT    /api/user/addresses/:id        - C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ
DELETE /api/user/addresses/:id        - X√≥a ƒë·ªãa ch·ªâ
PATCH  /api/user/addresses/:id/default - ƒê·∫∑t ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh

// Order History Routes
GET    /api/user/orders               - L·∫•y l·ªãch s·ª≠ ƒë∆°n h√†ng
GET    /api/user/orders/:id           - L·∫•y chi ti·∫øt ƒë∆°n h√†ng
GET    /api/user/orders/statistics/summary - L·∫•y th·ªëng k√™ ƒë∆°n h√†ng
```

#### 2. Controllers

**User Controller** (`backend/controllers/user.controller.js`)
- `getProfile()` - L·∫•y th√¥ng tin ng∆∞·ªùi d√πng
- `updateProfile()` - C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n
- `uploadAvatar()` - T·∫£i l√™n ·∫£nh ƒë·∫°i di·ªán v·ªõi validation
- `removeAvatar()` - X√≥a ·∫£nh ƒë·∫°i di·ªán

**Address Controller** (`backend/controllers/address.controller.js`)
- `getUserAddresses()` - L·∫•y t·∫•t c·∫£ ƒë·ªãa ch·ªâ
- `createAddress()` - T·∫°o ƒë·ªãa ch·ªâ m·ªõi
- `updateAddress()` - C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ
- `deleteAddress()` - X√≥a ƒë·ªãa ch·ªâ
- `setDefaultAddress()` - ƒê·∫∑t ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh

**Order Controller** (`backend/controllers/order.controller.js`)
- `getUserOrders()` - L·∫•y l·ªãch s·ª≠ ƒë∆°n h√†ng v·ªõi ph√¢n trang
- `getOrder()` - L·∫•y chi ti·∫øt ƒë∆°n h√†ng
- `getOrderStatistics()` - Th·ªëng k√™ ƒë∆°n h√†ng

#### 3. Middleware & Configuration

**Auth Middleware** (`backend/middleware/auth.middleware.js`)
- `protect` - X√°c th·ª±c JWT token
- `isAdmin`, `isRestaurantOwner`, `isDriver` - Ph√¢n quy·ªÅn

**Database Config** (`backend/config/database.js`)
- Connection pool MySQL
- Query wrapper functions
- Error handling

### Frontend Components

#### 1. Main Component
**PersonalInformationManager** (`frontend/src/components/profile/PersonalInformationManager.vue`)
- Tab navigation (Profile, Addresses, Orders)
- Loading states v√† error handling
- Notification system

#### 2. Profile Management
**UserProfileForm** (`frontend/src/components/profile/UserProfileForm.vue`)
- Form validation v·ªõi Vuetify rules
- Avatar upload v·ªõi preview
- Notification preferences
- Real-time validation

#### 3. Address Management
**AddressManagement** (`frontend/src/components/profile/AddressManagement.vue`)
- CRUD operations cho ƒë·ªãa ch·ªâ
- Set default address
- Address type icons
- Responsive card layout

#### 4. Order History
**OrderHistoryView** (`frontend/src/components/profile/OrderHistoryView.vue`)
- Pagination v√† filtering
- Order statistics dashboard
- Search functionality
- Order actions (view details, rate, reorder)

### Frontend Services

#### 1. API Services
**User Profile Service** (`frontend/src/services/userProfile.service.js`)
```javascript
// Available methods
userProfileService.getProfile()
userProfileService.updateProfile(data)
userProfileService.uploadAvatar(file)
userProfileService.removeAvatar()
```

**Address Service** (`frontend/src/services/address.service.js`)
```javascript
// Available methods
addressService.getUserAddresses()
addressService.createAddress(data)
addressService.updateAddress(id, data)
addressService.deleteAddress(id)
addressService.setDefaultAddress(id)
```

**Order Service** (`frontend/src/services/order.service.js`)
```javascript
// Available methods
orderService.getUserOrders(params)
orderService.getOrder(id)
orderService.getOrderStatistics()
```

#### 2. Vuex Store Module
**User Module** (`frontend/src/store/modules/user.js`)

**State:**
```javascript
{
  profile: null,
  addresses: [],
  recentOrders: [],
  orderStatistics: null,
  isLoading: false,
  error: null
}
```

**Getters:**
- Profile info: `fullName`, `email`, `phone`, `profileImage`
- Address info: `defaultAddress`, `addressCount`, `homeAddresses`
- Order info: `totalOrdersCount`, `totalSpent`, `favoriteRestaurants`

**Actions:**
- Profile: `fetchProfile`, `updateProfile`, `uploadAvatar`, `removeAvatar`
- Address: `fetchAddresses`, `createAddress`, `updateAddress`, `deleteAddress`, `setDefaultAddress`
- Orders: `fetchRecentOrders`, `fetchOrderStatistics`

## üìù T√≠nh nƒÉng chi ti·∫øt

### 1. Qu·∫£n l√Ω Profile

#### Th√¥ng tin c√≥ th·ªÉ ch·ªânh s·ª≠a:
- **H·ªç v√† t√™n** (fullName) - Required
- **Email** - Required, unique validation
- **S·ªë ƒëi·ªán tho·∫°i** (phone) - Optional, format validation
- **ƒê·ªãa ch·ªâ** (address) - Textarea
- **Ng√¥n ng·ªØ ∆∞a th√≠ch** (preferredLanguage) - vi/en
- **·∫¢nh ƒë·∫°i di·ªán** (profileImage) - Upload/remove v·ªõi validation

#### Notification Preferences:
- Email notifications
- SMS notifications  
- Order updates
- Promotions

#### Validation:
- File size limit: 5MB
- File type: images only
- Email format validation
- Phone number format validation

### 2. Qu·∫£n l√Ω ƒê·ªãa ch·ªâ

#### Th√¥ng tin ƒë·ªãa ch·ªâ:
- **T√™n ƒë·ªãa ch·ªâ** (name) - Required
- **Lo·∫°i ƒë·ªãa ch·ªâ** (type) - home/work/other
- **ƒê·ªãa ch·ªâ chi ti·∫øt** (addressLine1) - Required
- **ƒê·ªãa ch·ªâ b·ªï sung** (addressLine2) - Optional
- **Ph∆∞·ªùng/X√£** (ward) - Required
- **Qu·∫≠n/Huy·ªán** (district) - Required
- **T·ªânh/Th√†nh ph·ªë** (city) - Required
- **M√£ b∆∞u ƒëi·ªán** (postalCode) - Required, format validation
- **S·ªë ƒëi·ªán tho·∫°i** (phone) - Optional
- **T√™n ng∆∞·ªùi nh·∫≠n** (contactName) - Optional
- **SƒêT ng∆∞·ªùi nh·∫≠n** (contactPhone) - Optional
- **T·∫ßng** (floor) - Optional
- **S·ªë cƒÉn h·ªô** (apartmentNumber) - Optional
- **Ghi ch√∫ giao h√†ng** (instructions) - Optional
- **C√≥ thang m√°y** (hasElevator) - Boolean
- **ƒê·ªãa ch·ªâ m·∫∑c ƒë·ªãnh** (isDefault) - Boolean

#### T√≠nh nƒÉng:
- Set default address (ch·ªâ c√≥ 1 default)
- Delete address (kh√¥ng th·ªÉ x√≥a n·∫øu l√† default v√† ch·ªâ c√≥ 1 ƒë·ªãa ch·ªâ)
- Address type icons
- Responsive card layout

### 3. L·ªãch s·ª≠ ƒë∆°n h√†ng

#### Th√¥ng tin ƒë∆°n h√†ng:
- Order number, restaurant info
- Order items v·ªõi quantity
- Order status v·ªõi color coding
- Total amount
- Created date
- Order actions

#### T√≠nh nƒÉng filter:
- **Search** - T√¨m theo order number, restaurant name, item name
- **Status filter** - T·∫•t c·∫£ tr·∫°ng th√°i ƒë∆°n h√†ng
- **Time filter** - 7 ng√†y, 30 ng√†y, 3 th√°ng, 6 th√°ng, 1 nƒÉm

#### Order Statistics:
- **T·ªïng ƒë∆°n h√†ng** - Total orders count
- **T·ªïng chi ti√™u** - Total amount spent
- **ƒê√£ ho√†n th√†nh** - Completed orders count
- **ƒêang x·ª≠ l√Ω** - Pending orders count

#### Order Actions:
- **Xem chi ti·∫øt** - View order details
- **ƒê√°nh gi√°** - Rate order (for delivered orders)
- **ƒê·∫∑t l·∫°i** - Reorder items

## üöÄ H∆∞·ªõng d·∫´n Integration

### 1. Backend Setup

#### C√†i ƒë·∫∑t dependencies:
```bash
npm install multer jsonwebtoken bcryptjs mysql2
```

#### Environment variables (.env):
```
JWT_SECRET=your_jwt_secret
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=food_delivery
DB_PORT=3306
```

#### Register routes trong app.js:
```javascript
const userRoutes = require('./routes/user.routes');
app.use('/api/user', userRoutes);
```

#### T·∫°o uploads directory:
```bash
mkdir -p backend/uploads/avatars
```

### 2. Frontend Setup

#### Register components:
```javascript
// main.js ho·∫∑c router
import PersonalInformationManager from '@/components/profile/PersonalInformationManager.vue';
```

#### Add to Vuex store:
```javascript
// store/index.js
import user from './modules/user';

export default new Vuex.Store({
  modules: {
    user
  }
});
```

#### Add route:
```javascript
// router/index.js
{
  path: '/profile',
  name: 'Profile',
  component: () => import('@/views/UserProfile.vue'),
  meta: { requiresAuth: true }
}
```

### 3. Usage Example

#### Trong Vue component:
```vue
<template>
  <PersonalInformationManager />
</template>

<script>
import PersonalInformationManager from '@/components/profile/PersonalInformationManager.vue';

export default {
  components: {
    PersonalInformationManager
  }
};
</script>
```

#### Trong UserProfile.vue:
```vue
<template>
  <v-container class="profile-page py-8">
    <h1 class="text-h4 font-weight-bold mb-6">Th√¥ng tin c√° nh√¢n</h1>
    <PersonalInformationManager />
  </v-container>
</template>
```

## üîê Security Features

### Backend Security:
- JWT token authentication
- User authorization middleware
- File upload validation (size, type)
- SQL injection protection v·ªõi parameterized queries
- Input validation v·ªõi express-validator

### Frontend Security:
- Token storage trong localStorage
- Automatic token refresh
- Route guards cho protected pages
- File upload validation
- XSS protection v·ªõi Vuetify

## üì± Responsive Design

### Mobile First:
- Responsive grid layout
- Touch-friendly buttons
- Swipe gestures
- Mobile navigation
- Optimized forms

### Desktop Features:
- Multi-column layout
- Hover effects
- Keyboard shortcuts
- Advanced filtering

## üé® UI/UX Features

### Design System:
- Vuetify Material Design 3
- Consistent color scheme
- Loading states
- Error handling
- Success notifications

### Accessibility:
- Screen reader support
- Keyboard navigation
- High contrast support
- Focus indicators

## üìä Performance Optimizations

### Backend:
- Database indexing
- Connection pooling
- Query optimization
- File upload optimization

### Frontend:
- Lazy loading components
- Vuex state caching
- Debounced search
- Pagination
- Image optimization

## üß™ Testing Recommendations

### Backend Testing:
```javascript
// Example test file
describe('User Profile API', () => {
  it('should get user profile', async () => {
    const response = await request(app)
      .get('/api/user/profile')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);
  });
});
```

### Frontend Testing:
```javascript
// Example component test
describe('UserProfileForm', () => {
  it('should update profile successfully', async () => {
    // Test implementation
  });
});
```

## üîÑ Future Enhancements

### Planned Features:
1. **Real-time notifications** - WebSocket integration
2. **Social login** - Google, Facebook integration
3. **Two-factor authentication** - SMS/Email OTP
4. **Address autocomplete** - Google Maps API
5. **Order tracking** - Real-time order status
6. **Export data** - PDF/Excel export
7. **Profile sharing** - QR code generation

### Performance Improvements:
1. **Redis caching** - Cache frequently accessed data
2. **CDN integration** - Static file delivery
3. **Image compression** - Optimize uploaded images
4. **API rate limiting** - Prevent abuse

## üìû Support & Maintenance

### Error Monitoring:
- Comprehensive error logging
- User activity tracking
- Performance monitoring
- Security audit logs

### Backup & Recovery:
- Database backup strategy
- User data recovery
- File backup system
- Disaster recovery plan

---

## üìã Checklist ho√†n th√†nh

‚úÖ **Backend API** - Ho√†n th√†nh 100%
- [x] User profile CRUD
- [x] Address management 
- [x] Order history
- [x] File upload handling
- [x] Authentication & authorization

‚úÖ **Frontend Components** - Ho√†n th√†nh 100%
- [x] Personal info form
- [x] Address management
- [x] Order history view
- [x] Navigation tabs
- [x] Responsive design

‚úÖ **Services & Store** - Ho√†n th√†nh 100%
- [x] API services
- [x] Vuex store module
- [x] State management
- [x] Error handling

‚úÖ **Security & Validation** - Ho√†n th√†nh 100%
- [x] Input validation
- [x] File upload security
- [x] Authentication
- [x] Error handling

H·ªá th·ªëng qu·∫£n l√Ω th√¥ng tin c√° nh√¢n ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ho√†n ch·ªânh v√† s·∫µn s√†ng s·ª≠ d·ª•ng! üéâ